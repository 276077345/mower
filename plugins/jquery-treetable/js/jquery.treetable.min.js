(function(){var t,e,n,r,s;t=jQuery,e=function(){function e(e,n,i){var r;this.row=e,this.tree=n,this.settings=i,this.id=this.row.data(this.settings.nodeIdAttr),null!=(r=this.row.data(this.settings.parentIdAttr))&&""!==r&&(this.parentId=r),this.treeCell=t(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=t(this.settings.expanderTemplate),this.indenter=t(this.settings.indenterTemplate),this.children=[],this.initialized=!1,this.treeCell.prepend(this.indenter)}return e.prototype.addChild=function(t){return this.children.push(t)},e.prototype.ancestors=function(){var t,e;for(e=this,t=[];e=e.parentNode();)t.push(e);return t},e.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this.expander.find("i.fa").removeClass(this.settings.expanderExpandedClass).addClass(this.settings.expanderCollapsedClass),this.initialized&&null!=this.settings.onNodeCollapse&&this.settings.onNodeCollapse.apply(this),this)},e.prototype.collapsed=function(){return this.row.hasClass("collapsed")},e.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),this.initialized&&null!=this.settings.onNodeExpand&&this.settings.onNodeExpand.apply(this),t(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this.expander.find("i.fa").removeClass(this.settings.expanderCollapsedClass).addClass(this.settings.expanderExpandedClass),this)},e.prototype.expanded=function(){return this.row.hasClass("expanded")},e.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},e.prototype.isBranchNode=function(){return this.children.length>0||!0===this.row.data(this.settings.branchAttr)},e.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},e.prototype.level=function(){return this.ancestors().length},e.prototype.parentNode=function(){return null!=this.parentId?this.tree[this.parentId]:null},e.prototype.removeChild=function(e){var n=t.inArray(e,this.children);return this.children.splice(n,1)},e.prototype.render=function(){var e,n,i=this.settings;return!0===i.expandable&&this.isBranchNode()&&(e=function(e){return t(this).parents("table").treetable("node",t(this).parents("tr").data(i.nodeIdAttr)).toggle(),e.preventDefault()},this.indenter.html(this.expander),(n=!0===i.clickableNodeNames?this.treeCell:this.expander).off("click.treetable").on("click.treetable",e),n.off("keydown.treetable").on("keydown.treetable",function(t){13==t.keyCode&&e.apply(this,[t])})),this.indenter[0].style.paddingLeft=this.level()*i.indent+"px",this},e.prototype.reveal=function(){return null!=this.parentId&&this.parentNode().reveal(),this.expand()},e.prototype.setParent=function(t){return null!=this.parentId&&this.tree[this.parentId].removeChild(this),this.parentId=t.id,this.row.data(this.settings.parentIdAttr,t.id),t.addChild(this)},e.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},e.prototype.toggle=function(){return this.expanded()?this.collapse():this.expand(),this},e.prototype._hideChildren=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.children).length;e<n;e++)t=i[e],r.push(t.hide());return r},e.prototype._initialize=function(){var t=this.settings;return this.render(),!0===t.expandable&&"collapsed"===t.initialState?this.collapse():this.expand(),null!=t.onNodeInitialized&&t.onNodeInitialized.apply(this),this.initialized=!0},e.prototype._showChildren=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.children).length;e<n;e++)t=i[e],r.push(t.show());return r},e}(),n=function(){function n(t,e){this.table=t,this.settings=e,this.tree={},this.nodes=[],this.roots=[]}return n.prototype.collapseAll=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.nodes).length;e<n;e++)t=i[e],r.push(t.collapse());return r},n.prototype.expandAll=function(){var t,e,n,i,r;for(r=[],e=0,n=(i=this.nodes).length;e<n;e++)t=i[e],r.push(t.expand());return r},n.prototype.findLastNode=function(t){return t.children.length>0?this.findLastNode(t.children[t.children.length-1]):t},n.prototype.loadRows=function(n){var i,r,s;if(null!=n)for(s=0;s<n.length;s++)null!=(r=t(n[s])).data(this.settings.nodeIdAttr)&&(i=new e(r,this.tree,this.settings),this.nodes.push(i),this.tree[i.id]=i,null!=i.parentId?this.tree[i.parentId].addChild(i):this.roots.push(i));for(s=0;s<this.nodes.length;s++)i=this.nodes[s].updateBranchLeafClass();return this},n.prototype.move=function(e,n){var i=e.parentNode();return e!==n&&n.id!==e.parentId&&-1===t.inArray(e,n.ancestors())&&(e.setParent(n),this._moveRows(e,n),1===e.parentNode().children.length&&e.parentNode().render()),i&&i.updateBranchLeafClass(),e.parentNode()&&e.parentNode().updateBranchLeafClass(),e.updateBranchLeafClass(),this},n.prototype.removeNode=function(e){this.unloadBranch(e),e.row.remove(),delete this.tree[e.id],this.nodes.splice(t.inArray(e,this.nodes),1)},n.prototype.render=function(){var t,e,n;for(t=0,e=(n=this.roots).length;t<e;t++)n[t].show();return this},n.prototype.sortBranch=function(t,e){return t.children.sort(e),this._sortChildRows(t),this},n.prototype.unloadBranch=function(t){var e;for(e=0;e<t.children.length;e++)this.removeNode(t.children[e]);return t.children=[],t.updateBranchLeafClass(),this},n.prototype._moveRows=function(t,e){var n,i=t.children;for(t.row.insertAfter(e.row),t.render(),n=i.length-1;n>=0;n--)this._moveRows(i[n],t)},n.prototype._sortChildRows=function(t){return this._moveRows(t,t)},n}(),r={init:function(e,i){var r;return(r=t.extend({branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!1,expanderTemplate:"<a href='#'><i class='fa fa-lg'></i></a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",expanderExpandedClass:"fa-caret-down",expanderCollapsedClass:"fa-caret-right",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null,persist:!0,persistStoreName:"treetable_store"},e)).persist&&(s=new Persist.Store(r.persistStoreName)),this.each(function(){var e,s=t(this);return(i||s.data("treetable")===undefined)&&((e=new n(this,r)).loadRows(this.rows).render(),s.addClass("treetable").data("treetable",e),null!=r.onInitialized&&r.onInitialized.apply(e)),s})},destroy:function(){return this.each(function(){return t(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){return this.data("treetable").collapseAll(),this},collapseNode:function(t){var e=this.data("treetable").tree[t];if(!e)throw new Error("Unknown node '"+t+"'");return e.collapse(),this},expandAll:function(){return this.data("treetable").expandAll(),this},expandNode:function(t){var e=this.data("treetable").tree[t];if(!e)throw new Error("Unknown node '"+t+"'");return e.initialized||e._initialize(),e.expand(),this},loadBranch:function(e,n){var i=this.data("treetable").settings,r=this.data("treetable").tree;if(n=t(n),null==e)this.append(n);else{var s=this.data("treetable").findLastNode(e);n.insertAfter(s.row)}return this.data("treetable").loadRows(n),n.filter("tr").each(function(){r[t(this).data(i.nodeIdAttr)].show()}),null!=e&&e.render().expand(),this},move:function(t,e){var n,i;return i=this.data("treetable").tree[t],n=this.data("treetable").tree[e],this.data("treetable").move(i,n),this},node:function(t){return this.data("treetable").tree[t]},removeNode:function(t){var e=this.data("treetable").tree[t];if(!e)throw new Error("Unknown node '"+t+"'");return this.data("treetable").removeNode(e),this},reveal:function(t){var e=this.data("treetable").tree[t];if(!e)throw new Error("Unknown node '"+t+"'");return e.reveal(),this},sortBranch:function(e,n){var i,r=this.data("treetable").settings;return n=n||r.column,i=n,t.isNumeric(n)&&(i=function(e,i){var r,s,a;return r=function(e){var i=e.row.find("td:eq("+n+")").text();return t.trim(i).toUpperCase()},s=r(e),a=r(i),s<a?-1:s>a?1:0}),this.data("treetable").sortBranch(e,i),this},unloadBranch:function(t){return this.data("treetable").unloadBranch(t),this},persistTreeState:function(){t.each(this.data("treetable").tree,function(e,n){t(n.row).hasClass("expanded")?s.set(n.id,"1"):s.remove(n.id)})},getPersistedTreeState:function(){t.each(this.data("treetable").tree,function(t,e){"1"==s.get(e.id)&&e&&(e.initialized||e._initialize(),e.expand())})},expandLevel:function(e){var n,r=this;if(t.each(r.data("treetable").tree,function(t,e){if(e)return n=e,!1}),n){var s=new Array;for(s.push(n.id),expandChildren=function(e){var n=new Array;return t.each(e,function(e,i){var s=r.data("treetable").tree[i];if(s&&(s.initialized||s._initialize(),s.expand()),s){var a=s.children;t.each(a,function(t,e){e&&(e.initialized||e._initialize(),n.push(e.id))})}}),n},i=0;i<e;i++)s=expandChildren(s)}}},t.fn.treetable=function(e){return r[e]?r[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?t.error("Method "+e+" does not exist on jQuery.treetable"):r.init.apply(this,arguments)},this.TreeTable||(this.TreeTable={}),this.TreeTable.Node=e,this.TreeTable.Tree=n}).call(this);